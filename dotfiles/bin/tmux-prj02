mkdir -p dotfiles/bin

cat > dotfiles/bin/tmux-prj02 <<'EOF'
#!/usr/bin/env bash
# Open or create tmux session "prj02" with 4 panes:
#   - split vertically, then horizontally on each side
#   - TL: nvim lib/matrix.h
#   - TR: nvim src/main.cpp
#   - BL: nvim README-milestone1.md
#   - BR: shell
set -euo pipefail

SESSION="prj02"
WIN="1"

in_tmux() { [ -n "${TMUX-}" ]; }

if tmux has-session -t "$SESSION" 2>/dev/null; then
  # Session exists: jump to it
  if in_tmux; then
    tmux switch-client -t "$SESSION"
  else
    tmux attach -t "$SESSION"
  fi
  exit 0
fi

# Create new session, window starts in current working directory
tmux new-session -d -s "$SESSION" -n editor

# Start with one pane (left). Make right split firstâ€¦
tmux split-window -h -t "${SESSION}:${WIN}"

# Split the LEFT side horizontally (creates TL + BL)
tmux select-pane -t "${SESSION}:${WIN}.0"
tmux split-window -v -t "${SESSION}:${WIN}.0"

# Split the RIGHT side horizontally (creates TR + BR)
tmux select-pane -t "${SESSION}:${WIN}.1"
tmux split-window -v -t "${SESSION}:${WIN}.1"

# Now panes should be:
#  0 TL, 1 TR, 2 BL, 3 BR
tmux send-keys -t "${SESSION}:${WIN}.0" 'nvim lib/matrix.h' C-m
tmux send-keys -t "${SESSION}:${WIN}.1" 'nvim src/main.cpp' C-m
tmux send-keys -t "${SESSION}:${WIN}.2" 'nvim README-milestone1.md' C-m

# Focus top-left by default
tmux select-pane -t "${SESSION}:${WIN}.0"

# Attach or switch
if in_tmux; then
  tmux switch-client -t "$SESSION"
else
  tmux attach -t "$SESSION"
fi
EOF

chmod +x dotfiles/bin/tmux-prj02
